/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['sap/viz/ui5/data/DimensionDefinition','sap/viz/ui5/data/MeasureDefinition','sap/viz/ui5/controls/common/feeds/FeedItem','sap/viz/ui5/controls/common/feeds/AnalysisObject'],function(D,M,F,A){"use strict";var s=function(){return sap.viz.vizservices.BVRService.suggestFeeds.apply(null,arguments);};var c=function(a,f){return sap.viz.vizservices.FeedService.validate(a,s(a,f,[{id:"MND",type:"MND"}]).feedItems);};var _=[{"types":"*","toViz":{"category|category2":"categoryAxis","series":"color","axis1|axis2|axis3|axis4":"valueAxis"}},{"types":"column|bar|stacked_bar|stacked_column|line|combination|100_stacked_bar|100_stacked_column|stacked_combination|horizontal_stacked_combination","toViz":{}},{"types":"scatter|bubble|time_bubble|timeseries_scatter|timeseries_bubble","toViz":{"series":"series","category|category2":"series","axis1":"valueAxis","axis2":"valueAxis2"}},{"types":"bubble|time_bubble","toViz":{"axis3":"bubbleWidth"}},{"types":"pie|donut","toViz":{"category|series|category2":"color","axis1|axis2|axis3|axis4":"size"}},{"types":"bullet|vertical_bullet","toViz":{"axis1":"actualValues","axis2":"targetValues","axis3":"forecastValues","axis4":"additionalValues"}},{"types":"dual_combination|dual_stacked_bar|100_dual_stacked_bar|dual_stacked_column|100_dual_stacked_column|dual_bar|dual_column|dual_line|dual_stacked_combination|dual_horizontal_stacked_combination","toViz":{"axis1":"valueAxis","axis2|axis3|axis4":"valueAxis2"}},{"types":"timeseries_line","toViz":{"category":"timeAxis","axis1|axis2|axis3":"valueAxis"}},{"types":"timeseries_scatter","toViz":{"category":"timeAxis","axis2|axis3":false}},{"types":"timeseries_bubble","toViz":{"category":"timeAxis","axis2":false,"axis3":"bubbleWidth"}},{"types":"timeseries_column","toViz":{"category":"timeAxis","axis1|axis2|axis3|axis4":"valueAxis"}},{"types":"heatmap","toViz":{"category":"categoryAxis","category2":"categoryAxis2","axis1|axis2|axis3":"color"}},{"types":"waterfall","toViz":{"series":"waterfallType","axis1|axis2|axis3|axis4":"valueAxis"}},{"types":"horizontal_waterfall","toViz":{"series":"waterfallType","axis1|axis2|axis3|axis4":"valueAxis"}}].reduce(function(m,a){var b=Object.keys(a.toViz).reduce(function(b,f){f.split("|").forEach(function(r){b[r]=a.toViz[f];return b;});return b;},{});a.types.split("|").forEach(function(f){if(!m.hasOwnProperty(f)){m[f]=[];}m[f].push(b);});return m;},{});var d=Object.keys(_).reduce(function(m,a){if(a!=="*"){m[a]=jQuery.extend.apply(null,[true,{}].concat(_["*"].concat(_[a])));}return m;},{});function e(a,k,v){var b=(typeof k==="function")?k:function(o){return o[k];};return a.reduce(function(G,E){var f=b(E),m=(typeof v==="function")?v(E):E;if(f&&!G[f]){G[f]=[m];}else if(f){G[f].push(m);}return G;},{});}function g(a,k){return a.reduce(function(m,b,f){m[k(b)]=f;return m;},{});}function h(m,a){return e(a,function(o){return m[o.getRole()];});}var i={"Edm.DateTime":true};var j={};j["timeseries_line"]=true;j["timeseries_column"]=true;j["timeseries_bubble"]=true;j["timeseries_scatter"]=true;var L={from:F.fromLightWeightFmt,to:function toLwFeedFmt(f,m){var a=F.toLightWeightFmt(f);a.forEach(function(b){b.values.forEach(function(v){if(v.dataType==="Date"&&!i[m[v.id]]){delete v.dataType;}});});return a;},build:function(o,m){var a=[];jQuery.each(o.dims,function(k,v){a.push({id:k,type:"Dimension",values:v.map(l("Dimension",m))});});jQuery.each(o.msrs,function(k,v){a.push({id:k,type:"Measure",values:v.map(l("Measure",m))});});return a;}};function l(T,m){return function(o){var I=o.getName();if(I==="MND"&&!m.hasOwnProperty(I)){return{id:"MND",type:"MND"};}var a={id:I,name:I,type:T};if(T==="Dimension"&&a&&a.id&&m&&m[a.id]&&i&&i[m[a.id]]){a.dataType="Date";}return a;};}function w(o){var n=o.getName(),a=o.getLabel(),T=o.getTextProperty(),f=o.getTextFormatter(),b=o.getDisplayText();var k={identity:n,name:a||n,value:"{"+n+"}"};if(typeof f==="function"){k.displayValue={formatter:f,parts:[{path:n,type:new sap.ui.model.type.String()}]};if(T){k.displayValue.parts.push({path:T,type:new sap.ui.model.type.String()});}}else if(b&&T){k.displayValue="{"+T+"}";}return new D(k);}function p(m){var n=m.getName();return new M({identity:n,name:m.getLabel()||n,value:"{"+n+"}"});}function q(C,f){var m=sap.viz.api.metadata.Viz.get("info/"+C),b=e(m.bindings,"role"),a=e(f,"id"),k=b["layout.category"]||[],S=b["mark.color"]||[];if(k.length===0){return[];}else{var o=[];jQuery.each(k.concat(S),function(n,r){var v=a[r.id];if(v&&v.length>0){jQuery.each(v[0].values,function(E,V){o.push(V.id);});}});return o;}}function t(C,a,m,S,b){var r=d[C];var o={dims:h(r,a),msrs:h(r,m)};if(o.dims.series){o.dims[S]=o.dims.series;delete o.dims.series;}return L.build(o,b);}function u(C,a,m,S,b){var k=t(C,a,m,S,b),V=c("info/"+C,k);if(!V.valid){k=x(C,V,k,a,m,b);}var n=k.reduce(function(r,f){f.values.forEach(function(v){r[v.id]=true;});return r;},{});var o=L.from(k);o._unused=y(k,a,m);o._def=z(a,m,n);o._order=q(C,k);if(j[C]){B(o);}return o;}function x(C,V,E,f,m,n){var r=sap.viz.api.metadata.Viz.get("info/"+C),G=e(r.bindings,"id"),H=false,I=false;Object.keys(V.results.bindings).forEach(function(k){if(!G[k]){return;}if(G[k][0].type==="Measure"){I=true;}if(G[k][0].type==="Dimension"){H=true;}});var J=E.filter(function(a){return!((a.type==="Dimension")?H:I);}),K=J.reduce(function(a,b){(b.values||[]).forEach(function(v){a[v.id]=true;});return a;},{});var N=f.map(l("Dimension",n)),O=m.map(l("Measure")),P=g(f,function(o){return o.getName();}),Q=g(m,function(o){return o.getName();});N.sort(function(a,b){return P[a.id]-P[b.id];});O.sort(function(a,b){return Q[a.id]-Q[b.id];});var S=s("info/"+C,J,N.concat(O).filter(function(a){return!K[a.id];})).feedItems;S.forEach(function(o){o.type=G[o.id][0].type;});return S;}function y(a,b,m){var U=a.reduce(function(k,f){f.values.forEach(function(v){k[v.id]=true;});return k;},{});return b.concat(m).filter(function(n){return!U[n.getName()];}).map(function(n){return n.getName();});}function z(a,m,v){return{dim:a.reduce(function(V,o){if(v[o.getName()]){V.push(w(o));}return V;},[]),msr:m.reduce(function(V,o){if(v[o.getName()]){V.push(p(o));}return V;},[])};}function B(f){var T=f.filter(function(o){return o.getUid()==="timeAxis";})[0],a=T.getValues().map(function(o){return(typeof o==="string")?o:o.getUid();});f._def.dim.forEach(function(o){if(a.indexOf(o.getIdentity())!==-1){o.setDataType("Date");}});}return{fit:u,compatible:function(C,a,m,b){var I="info/"+C,f={used:{},error:null,compatible:true};var n=t(C,a,m,"color",b),V=c(I,n);if(!V.valid){n=x(C,V,n,a,m,b);V=c(I,n);f.needFix=true;}if(V.valid){f.used=e(n,function(o){return o.type;},function(o){return o.values.filter(function(v){return v.type==="Dimension"||v.type==="Measure";}).map(function(v){return v.id;});});jQuery.each(f.used,function(k,v){f.used[k]=v.reduce(function(o,N){return o.concat(N);},[]);});}else{f.compatible=false;var r=sap.viz.api.metadata.Viz.get(I).bindings,E=e(r,"type",function(o){return o.id;}),G={dim:0,msr:0,time:0};jQuery.each(V.results.bindings,function(k,v){if(!v.missing){return;}if(E.Dimension.indexOf(k)!==-1){G[k==="timeAxis"?"time":"dim"]+=v.missing;}else if(E.Measure.indexOf(k)!==-1){G.msr+=v.missing;}});f.error={missing:G};}return f;}};});
