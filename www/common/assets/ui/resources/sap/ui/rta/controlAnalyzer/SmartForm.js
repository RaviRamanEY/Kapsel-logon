/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['sap/ui/rta/controlAnalyzer/Base','sap/ui/rta/Utils','sap/ui/dt/ElementUtil','sap/ui/rta/ModelConverter'],function(B,U,E,M){"use strict";var S=B.extend("sap.ui.rta.controlAnalyzer.SmartForm",{metadata:{library:"sap.ui.rta",properties:{}}});S.prototype.init=function(){};S.prototype.getFlexChangeType=function(t,e){var f;switch(t){case"Move":if(E.isInstanceOf(e,"sap.ui.comp.smartform.SmartForm")){f="moveGroups";}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.Group")){f="moveFields";}break;case"Add":if(E.isInstanceOf(e,"sap.ui.comp.smartform.SmartForm")){f="addGroup";}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.Group")){f="addFields";}break;case"Rename":if(E.isInstanceOf(e,"sap.ui.comp.smartform.SmartForm")){f="renameField";}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.Group")){f="renameGroup";}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.GroupElement")){f="renameField";}break;default:break;}return f;};S.prototype.mapSpecificChangeData=function(t,s){var r;switch(t){case"Move":r=this._mapMoveSpecificChangeData(t,s);break;case"Add":r=this._mapAddSpecificChangeData(t,s);break;case"Rename":r=this._mapRenameSpecificChangeData(t,s);break;default:r=this.prototype.mapSpecificChangeData(t,s);break;}return r;};S.prototype.getLabel=function(e){if(E.isInstanceOf(e,"sap.ui.comp.smartform.SmartForm")){return e.getTitle();}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.Group")){return e.getLabel();}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.GroupElement")){return e.getLabelText();}};S.prototype.getLabelBinding=function(e){if(E.isInstanceOf(e,"sap.ui.comp.smartform.SmartForm")){return e.getBindingInfo("title");}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.Group")||E.isInstanceOf(e,"sap.ui.comp.smartform.GroupElement")){return e.getBindingInfo("label");}};S.prototype.applyLabelBinding=function(e,b){if(E.isInstanceOf(e,"sap.ui.comp.smartform.SmartForm")){e.bindProperty("title",b);}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.Group")||E.isInstanceOf(e,"sap.ui.comp.smartform.GroupElement")){e.bindProperty("label",b);}};S.prototype._mapMoveSpecificChangeData=function(t,s){var a=s.source.id;var T=s.target.id;var c={changeType:s.changeType,selector:{id:a},targetId:T!==a?T:null};c[s.changeType]=[];s.movedElements.forEach(function(m){c[s.changeType].push({id:m.id,index:m.targetIndex});});return c;};S.prototype._mapAddSpecificChangeData=function(t,s){if(s.changeType==="addFields"){s.fieldLabels=s.labels;delete s.labels;}else if(s.changeType==="addGroup"){s.groupLabel=s.labels[0];delete s.labels;}return s;};S.prototype._mapRenameSpecificChangeData=function(t,s){var e=s.element;if(E.isInstanceOf(e,"sap.ui.comp.smartform.SmartForm")){s.fieldLabel=s.value;}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.Group")){s.groupLabel=s.value;}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.GroupElement")){s.fieldLabel=s.value;}delete s.value;delete s.element;return s;};S.prototype.getSelectedBlock=function(c){return U.findSupportedBlock(c,["sap.ui.comp.smartform.Group"]);};S.prototype.getClosestType=function(c){return U.getClosestTypeForControl(c,"sap.ui.comp.smartform.SmartForm");};S.prototype.createChangeData=function(c,C,h){var m={};var b=c.getBindingContext().getObject();var s=b.controlId?b.controlId:C.getId()+"_"+b.entityName+"_"+b.name;var o=sap.ui.getCore().byId(s);var a=!!o;var f=function(){if(a){m={controlId:s,changeType:h?"hideControl":"unhideControl"};}else{var d=b.complexTypeName?b.complexTypeName+"/"+b.name:b.name;if(C){var g;if(C instanceof sap.ui.comp.smartform.Group){g=C;}else{g=C.getGroups()[0];}m={unhide:a,newControlId:s,jsType:"sap.ui.comp.smartfield.SmartField",selectorId:g.getId(),index:g.getGroupElements().length+1,valueProperty:"value",changeType:"addField",fieldLabel:b.fieldLabel,fieldValue:d};}}return m;};if(h&&!U.isElementHideable(o)){return U.openHideElementConfirmationDialog(o).then(function(d){if(d){return f();}else{return null;}});}else{return new Promise(function(r,d){r(f());});}};S.prototype.findVisibleAndBoundFieldsAndLabelNames=function(c){var v=[];var b=[];var f={};var F={};var e=E.findAllPublicElements(c);var i=0;for(i=0;i<e.length;i++){var o=e[i];if(o.mBindingInfos){for(var I in o.mBindingInfos){var p=U.getPathFromBindingInfo(I,o.mBindingInfos);var P=o.getParent();if(P&&p){F[p]=I;var s=U.getLabelForElement(P);if(s){f[p]=s;}if(o.getDomRef()){v[p]=P.getId();}b[p]=P.getId();}}}}return{visibleAndBoundFields:v,boundFieldsId:b,fieldsAndLabelNames:f,fieldsAndBoundPropertyName:F};};S.prototype.isCustomFieldAvailable=function(c){return U.isCustomFieldAvailable(c);};S.prototype.getCustomizeControlModel=function(c,f){var C=this.getClosestType(c);var e=C.getEntityType();if(e){e=e.replace(/\s+/g,'').match(/([^,]+)/g);}if(!f){return M.getConvertedModelWithBoundAndRenamedLabels(C,e,this);}else{return M.getConvertedModelWithBoundAndRenamedLabels(C,e,this).then(function(a){return a.filter(function(m){return!m.checked;});});}};S.prototype.checkTargetZone=function(p,a,m){var s=E.getClosestElementOfType(m,"sap.ui.comp.smartform.SmartForm");var t=E.getClosestElementOfType(p,"sap.ui.comp.smartform.SmartForm");if(s===t){return true;}};return S;},true);
