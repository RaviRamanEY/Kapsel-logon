/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/fl/Utils','sap/ui/dt/OverlayUtil','sap/ui/dt/ElementUtil','sap/ui/comp/odata/FieldSelectorModelConverter','sap/ui/fl/registry/Settings','sap/ui/comp/smartform/GroupElement','sap/ui/comp/smartform/Group','sap/ui/comp/smartfield/SmartField','sap/uxap/ObjectPageSection','sap/uxap/ObjectPageLayout','sap/m/MessageBox'],function(q,F,O,E,a,S,G,b,c,d,e,M){"use strict";var U={};U.RESOLVED_PROMISE=Promise.resolve(true);U._aEditableTypes=["sap.ui.comp.smartform.SmartForm","sap.ui.comp.smartform.Group","sap.ui.comp.smartform.GroupElement","sap.uxap.ObjectPageSection","sap.uxap.ObjectPageLayout"];if(F.isVendorLayer()){U._aEditableTypes=U._aEditableTypes.concat(["sap.ui.comp.smartfilterbar.SmartFilterBar","sap.ui.comp.smarttable.SmartTable","sap.uxap.ObjectPageHeader","sap.uxap.ObjectPageHeaderActionButton","sap.ui.table.Column"]);}U._sFocusableOverlayClass=".sapUiDtOverlaySelectable";U.isCustomFieldAvailable=function(C){q.sap.require("sap.ui.fl.fieldExt.Access");var s=F.getComponentClassName(C);if(!s||s==""){return Promise.resolve(false);}var f=false;var t=this;return S.getInstance(s).then(function(o){if(o.isModelS){f=o.isModelS();}if(!f){return Promise.resolve();}else{var g=new a(C.getModel());var m=g.getMetaDataAnalyzer();var h=t.getBoundEntityType(C);try{var j=sap.ui.fl.fieldExt.Access.getBusinessContexts(m.oModel.sServiceUrl,h);j.fail(function(k){if(k){if(q.isArray(k.errorMessages)){for(var i=0;i<k.errorMessages.length;i++){q.sap.log.error(k.errorMessages[i].text);}}}return Promise.resolve(false);});return j.then(function(r){if(r){if(r.BusinessContexts){if(r.BusinessContexts.length>0){r.EntityType=h;return Promise.resolve(r);}}}});}catch(k){q.sap.log.error("exception occured in sap.ui.fl.fieldExt.Access.getBusinessContexts",k);return Promise.resolve();}}});};U.openHideElementConfirmationDialog=function(o){var t=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");var m;var T;return new Promise(function(r,f){var C=function(A){if(A==="OK"){r(true);}else{r(false);}};if(o instanceof b){m=t.getText("CTX_HIDE_GROUP_MESSAGE");T=t.getText("CTX_HIDE_GROUP_TITLE");}else{m=t.getText("CTX_HIDE_FIELD_MESSAGE");T=t.getText("CTX_HIDE_FIELD_TITLE");}M.confirm(m,{title:T,icon:"WARNING",onClose:C});});};U.isElementHideable=function(o){return((o instanceof G||o instanceof b||o instanceof d)&&!this.isElementMandatory(o));};U.isElementMandatory=function(o){var m=false;if(o instanceof G){var f=o.getFields();for(var i=0;i<f.length;i++){var g=f[i];if(g instanceof c){m=g.getMandatory();if(m){break;}}}}else if(o instanceof b){var h=o.getGroupElements();for(var j=0;j<h.length;j++){return this.isElementMandatory(h[j]);}}return m;};U.isOverlayMutable=function(o){var f=o.getElementInstance();var i,I,h;i=this._aEditableTypes.some(function(t){return E.isInstanceOf(f,t);});if(i){I=f.getVisible?f.getVisible():true;if(I){h=F.checkControlId(f);}}return i&&h;};U.isOverlaySelectable=function(o){return o.isSelectable()&&o.$().is(":visible");};U.getPreviousSelectableOverlay=function(o){var p=O.getPreviousOverlay(o);while(p&&!this.isOverlaySelectable(p)){p=O.getPreviousOverlay(p);}return p;};U.getNextSelectableOverlay=function(o){var n=O.getNextOverlay(o);while(n&&!this.isOverlaySelectable(n)){n=O.getNextOverlay(n);}return n;};U.getOverlayInstanceForDom=function(D){var i=q(D).attr("id");if(i){return sap.ui.getCore().byId(i);}};U.getFirstFocusableOverlay=function(){var $=q(this._sFocusableOverlayClass).first();var o=this.getOverlayInstanceForDom($);if(!this.isOverlaySelectable(o)){o=this.getNextSelectableOverlay(o);}return o;};U.getLastFocusableOverlay=function(){var $=q(this._sFocusableOverlayClass).last();var o=this.getOverlayInstanceForDom($);if(!this.isOverlaySelectable(o)){o=this.getPreviousSelectableOverlay(o);}return o;};U.getNextFocusableOverlay=function(){var f=this.getFocusedOverlay();if(f){return this.getNextSelectableOverlay(f);}};U.getPreviousFocusableOverlay=function(){var f=this.getFocusedOverlay();if(f){return this.getPreviousSelectableOverlay(f);}};U.getFocusedOverlay=function(){var o=sap.ui.getCore().byId(document.activeElement.id);if(o instanceof sap.ui.dt.ElementOverlay){return o;}};U.getFirstFocusableChildOverlay=function(o){var f=O.getFirstChildOverlay(o);while(f&&!this.isOverlaySelectable(f)){f=O.getNextSiblingOverlay(f);}return f;};U.getNextFocusableSiblingOverlay=function(o){var n=O.getNextSiblingOverlay(o);while(n&&!this.isOverlaySelectable(n)){n=O.getNextSiblingOverlay(n);}return n;};U.getPreviousFocusableSiblingOverlay=function(o){var p=O.getPreviousSiblingOverlay(o);while(p&&!this.isOverlaySelectable(p)){p=O.getPreviousSiblingOverlay(p);}return p;};U.getClosestViewFor=function(o){if(!o&&!o.getParent){return;}var p=o.getParent();if(p&&p.getMetadata().getName()!=="sap.ui.core.mvc.XMLView"){return this.getClosestViewFor(p);}return p;};U.getClosestTypeForControl=function(C,t){if(C&&C.getMetadata().getName()!==t){return this.getClosestTypeForControl(C.getParent(),t);}return C;};U._checkIsSupportedControl=function(C,s){for(var i=0;i<s.length;i++){if(C.getMetadata().getName()===s[i]){return true;}}};U.hasGroupUnBoundFields=function(g){var f=g.getGroupElements();for(var j=0;j<f.length;j++){var o=f[j];if(!this.hasGroupElementBoundFields(o)){return true;}}return false;};U.hasGroupElementBoundFields=function(g){var f=g.getFields();if(f.length===0){return true;}for(var j=0;j<f.length;j++){var o=f[j];if(!o.getDomRef()){continue;}if(this._isElementBound(o)){return true;}}return false;};U.hasGroupElementUnBoundFields=function(g){var f=g.getFields();if(f.length===0){return true;}for(var j=0;j<f.length;j++){var o=f[j];if(!o.getDomRef()){continue;}if(!this._isElementBound(o)){return true;}}return false;};U.getObjectPageSections=function(o){var f;var s=[];if(o.getMetadata().getName()==="sap.uxap.ObjectPageSection"){f=o.getParent();}else if(o.getMetadata().getName()==="sap.uxap.ObjectPageLayout"){f=o;}s=f.getAggregation("sections");return s;};U.hasObjectPageLayoutInvisibleSections=function(o){var s=U.getObjectPageSections(o);if(s.length===0){return false;}for(var i=0;i<s.length;i++){if(s[i].getVisible()===false){return true;}}return false;};U._isElementBound=function(o){var B=o.mBindingInfos;if(Object.keys(B).length===0){return false;}else{for(var p in B){var P=B[p].parts;for(var i=0;i<P.length;i++){if(P[i].model){var m=o.getModel(P[i].model).getMetadata().getName();if(m==="sap.ui.model.odata.ODataModel"||m==="sap.ui.model.odata.v2.ODataModel"){return true;}}else{var m=o.getModel().getMetadata().getName();if(m==="sap.ui.model.odata.ODataModel"||m==="sap.ui.model.odata.v2.ODataModel"){return true;}}}}}};U.findSupportedBlock=function(C,s){if(this._checkIsSupportedControl(C,s)){return C;}else{C=C.getParent();while(C){if(this._checkIsSupportedControl(C,s)){return C;}C=C.getParent();}}};U.createFieldLabelId=function(g,s,B){var C=g.getId()+"_"+s+"_"+B;C=C.replace("/","_");return C;};U.getLabelForElement=function(o){var f=o.getLabelText?o.getLabelText():undefined;if(!f){f=o.getLabel?o.getLabel():undefined;}if(!f){f=o.getText?o.getText():undefined;}return(typeof f)==="string"?f:undefined;};U.getPathFromBindingInfo=function(i,B){var p=B[i]?B[i]:undefined;if(p){if((p.parts instanceof Array)&&p.parts.length>0){p=p.parts[0]?p.parts[0]:undefined;}p=((typeof p.path)==="string")?p.path:p;}if((typeof p)==="string"){p=p;}else{p=undefined;}return p;};U.getBoundEntityType=function(o){var m=o.getModel();var B=o.getBindingContext();var f=m.oMetadata._getEntityTypeByPath(B.getPath());return f.name;};U.openNewWindow=function(u){window.open(u,"_blank");};return U;},true);
